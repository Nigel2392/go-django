# Queries and other database operations

**Note**: This documentation page was (in part) generated by ChatGPT and has been fully reviewed by [Nigel2392](github.com/Nigel2392).

The Pages app offers functions to manage the tree structure and content of pages.

- **FixTree(querySet models.DBQuerier, ctx context.Context) error**  
  Scans the database for tree inconsistencies and repairs them.

- **CreateRootNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error**  
  Creates a new root node. The node's path must be empty, and a title is required.

- **CreateChildNode(q models.DBQuerier, ctx context.Context, parent, child *pages_models.PageNode) error**  
  Creates a new child node under an existing parent node. The child node’s path is generated based on the parent’s URL path.

- **UpdateNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error**  
  Updates a node, recalculating its URL path if the slug has changed and updating all descendant paths.

- **DeleteNode(q models.DBQuerier, ctx context.Context, id int64, path string, depth int64) error**  
  Deletes a specific node from the tree.

- **MoveNode(q models.DBQuerier, ctx context.Context, node *pages_models.PageNode, newParent *pages_models.PageNode) error**  
  Moves a node to a new parent, updating the URL paths and tree structure accordingly.

- **PublishNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error**  
  Sets the published flag on the node and updates the database record.

- **UnpublishNode(q models.Querier, ctx context.Context, node *pages_models.PageNode, unpublishChildren bool) error**  
  Unpublishes a node (and optionally its descendants).

- **ParentNode(q models.Querier, ctx context.Context, path string, depth int) (pages_models.PageNode, error)**  
  Retrieves the parent node based on the current node’s path.

- **AncestorNodes(q models.Querier, ctx context.Context, p string, depth int) ([]pages_models.PageNode, error)**  
  Retrieves all ancestor nodes for a given node.

- **SavePage(q models.DBQuerier, ctx context.Context, parent *pages_models.PageNode, p SaveablePage) error**  
  Saves a custom page object to the database. The custom page’s `Save()` method is invoked before the reference node is created or updated.

- **UpdatePage(q models.DBQuerier, ctx context.Context, p SaveablePage) error**  
  Updates a custom page object in the database after updating its reference node.

- **DeletePage(q models.DBQuerier, ctx context.Context, p DeletablePage) error**  
  Deletes a custom page object and its reference node, then calls `FixTree` to maintain tree integrity.

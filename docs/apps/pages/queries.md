# Queries and other database operations

<strong>Note</strong>: This documentation page was (in part) generated by ChatGPT and has been fully reviewed by [Nigel2392](github.com/Nigel2392).

The Pages app offers functions to manage the tree structure and content of pages.

- <strong>FixTree(querySet models.DBQuerier, ctx context.Context) error</strong>  
  Scans the database for tree inconsistencies and repairs them.

- <strong>CreateRootNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error</strong>  
  Creates a new root node. The node's path must be empty, and a title is required.

- <strong>CreateChildNode(q models.DBQuerier, ctx context.Context, parent, child *pages_models.PageNode) error</strong>  
  Creates a new child node under an existing parent node. The child node’s path is generated based on the parent’s URL path.

- <strong>UpdateNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error</strong>  
  Updates a node, recalculating its URL path if the slug has changed and updating all descendant paths.

- <strong>DeleteNode(q models.DBQuerier, ctx context.Context, id int64, path string, depth int64) error</strong>  
  Deletes a specific node from the tree.

- <strong>MoveNode(q models.DBQuerier, ctx context.Context, node *pages_models.PageNode, newParent *pages_models.PageNode) error</strong>  
  Moves a node to a new parent, updating the URL paths and tree structure accordingly.

- <strong>PublishNode(q models.Querier, ctx context.Context, node *pages_models.PageNode) error</strong>  
  Sets the published flag on the node and updates the database record.

- <strong>UnpublishNode(q models.Querier, ctx context.Context, node *pages_models.PageNode, unpublishChildren bool) error</strong>  
  Unpublishes a node (and optionally its descendants).

- <strong>ParentNode(q models.Querier, ctx context.Context, path string, depth int) (pages_models.PageNode, error)</strong>  
  Retrieves the parent node based on the current node’s path.

- <strong>AncestorNodes(q models.Querier, ctx context.Context, p string, depth int) ([]pages_models.PageNode, error)</strong>  
  Retrieves all ancestor nodes for a given node.

- <strong>SavePage(q models.DBQuerier, ctx context.Context, parent *pages_models.PageNode, p SaveablePage) error</strong>  
  Saves a custom page object to the database. The custom page’s `Save()` method is invoked before the reference node is created or updated.

- <strong>UpdatePage(q models.DBQuerier, ctx context.Context, p SaveablePage) error</strong>  
  Updates a custom page object in the database after updating its reference node.

- <strong>DeletePage(q models.DBQuerier, ctx context.Context, p DeletablePage) error</strong>  
  Deletes a custom page object and its reference node, then calls `FixTree` to maintain tree integrity.

(()=>{"use strict";function t(t){return t.replace(/(?:[_-])([a-z0-9])/g,((t,e)=>e.toUpperCase()))}function e(t){return t.charAt(0).toUpperCase()+t.slice(1)}function o(t){return null!=t}function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function r(t,e){const o=s(t);return Array.from(o.reduce(((t,o)=>(function(t,e){const o=t[e];return Array.isArray(o)?o:[]}(o,e).forEach((e=>t.add(e))),t)),new Set))}function s(t){const e=[];for(;t;)e.push(t),t=Object.getPrototypeOf(t);return e.reverse()}function i(t){return t.reduce(((t,[e,o])=>Object.assign(Object.assign({},t),{[e]:o})),{})}function l(t,e,o){return t.application.getControllerForElementAndIdentifier(e,o)}function a(t,e,o){let n=l(t,e,o);return n||(t.application.router.proposeToConnectScopeForElementAndIdentifier(e,o),n=l(t,e,o),n||void 0)}function c([e,r],s){return function(e){const{token:r,typeDefinition:s}=e,i=`${a=r,a.replace(/([A-Z])/g,((t,e)=>`-${e.toLowerCase()}`))}-value`,l=function(t){const{controller:e,token:n,typeDefinition:r}=t,s=function(t){const{controller:e,token:n,typeObject:r}=t,s=o(r.type),i=o(r.default),l=s&&i,a=s&&!i,c=!s&&i,h=u(r.type),f=d(t.typeObject.default);if(a)return h;if(c)return f;if(h!==f)throw new Error(`The specified default value for the Stimulus Value "${e?`${e}.${n}`:n}" must match the defined type "${h}". The provided default value of "${r.default}" is of type "${f}".`);return l?h:void 0}({controller:e,token:n,typeObject:r}),i=d(r),l=u(r),a=s||i||l;if(a)return a;throw new Error(`Unknown value type "${e?`${e}.${r}`:n}" for "${n}" value`)}(e);var a;return{type:l,key:i,name:t(i),get defaultValue(){return function(t){const e=u(t);if(e)return h[e];const o=n(t,"default"),r=n(t,"type"),s=t;if(o)return s.default;if(r){const{type:t}=s,e=u(t);if(e)return h[e]}return t}(s)},get hasCustomDefaultValue(){return void 0!==d(s)},reader:f[l],writer:g[l]||g.default}}({controller:s,token:e,typeDefinition:r})}function u(t){switch(t){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function d(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(t)?"array":"[object Object]"===Object.prototype.toString.call(t)?"object":void 0}"function"==typeof Object.getOwnPropertySymbols||Object.getOwnPropertyNames,(()=>{function t(t){function e(){return Reflect.construct(t,arguments,new.target)}return e.prototype=Object.create(t.prototype,{constructor:{value:e}}),Reflect.setPrototypeOf(e,t),e}try{return function(){const e=t((function(){this.a.call(this)}));e.prototype.a=function(){},new e}(),t}catch(t){return t=>class extends t{}}})(),Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End",page_up:"PageUp",page_down:"PageDown"},i("abcdefghijklmnopqrstuvwxyz".split("").map((t=>[t,t])))),i("0123456789".split("").map((t=>[t,t]))));const h={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},f={array(t){const e=JSON.parse(t);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${t}" of type "${d(e)}"`);return e},boolean:t=>!("0"==t||"false"==String(t).toLowerCase()),number:t=>Number(t.replace(/_/g,"")),object(t){const e=JSON.parse(t);if(null===e||"object"!=typeof e||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${t}" of type "${d(e)}"`);return e},string:t=>t},g={default:function(t){return`${t}`},array:p,object:p};function p(t){return JSON.stringify(t)}class m{constructor(t){this.context=t}static get shouldLoad(){return!0}static afterLoad(t,e){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:e=this.element,detail:o={},prefix:n=this.identifier,bubbles:r=!0,cancelable:s=!0}={}){const i=new CustomEvent(n?`${n}:${t}`:t,{detail:o,bubbles:r,cancelable:s});return e.dispatchEvent(i),i}}m.blessings=[function(t){return r(t,"classes").reduce(((t,o)=>{return Object.assign(t,(n=o,{[`${n}Class`]:{get(){const{classes:t}=this;if(t.has(n))return t.get(n);{const e=t.getAttributeName(n);throw new Error(`Missing attribute "${e}"`)}}},[`${n}Classes`]:{get(){return this.classes.getAll(n)}},[`has${e(n)}Class`]:{get(){return this.classes.has(n)}}}));var n}),{})},function(t){return r(t,"targets").reduce(((t,o)=>{return Object.assign(t,(n=o,{[`${n}Target`]:{get(){const t=this.targets.find(n);if(t)return t;throw new Error(`Missing target element "${n}" for "${this.identifier}" controller`)}},[`${n}Targets`]:{get(){return this.targets.findAll(n)}},[`has${e(n)}Target`]:{get(){return this.targets.has(n)}}}));var n}),{})},function(t){const o=function(t,e){return s(t).reduce(((t,o)=>(t.push(...function(t,e){const o=t[e];return o?Object.keys(o).map((t=>[t,o[t]])):[]}(o,e)),t)),[])}(t,"values"),n={valueDescriptorMap:{get(){return o.reduce(((t,e)=>{const o=c(e,this.identifier),n=this.data.getAttributeNameForKey(o.key);return Object.assign(t,{[n]:o})}),{})}}};return o.reduce(((t,o)=>Object.assign(t,function(t,o){const n=c(t,void 0),{key:r,name:s,reader:i,writer:l}=n;return{[s]:{get(){const t=this.data.get(r);return null!==t?i(t):n.defaultValue},set(t){void 0===t?this.data.delete(r):this.data.set(r,l(t))}},[`has${e(s)}`]:{get(){return this.data.has(r)||n.hasCustomDefaultValue}}}}(o))),n)},function(o){return r(o,"outlets").reduce(((o,n)=>Object.assign(o,function(o){const n=t(o.replace(/--/g,"-").replace(/__/g,"_"));return{[`${n}Outlet`]:{get(){const t=this.outlets.find(o),e=this.outlets.getSelectorForOutletName(o);if(t){const e=a(this,t,o);if(e)return e;throw new Error(`The provided outlet element is missing an outlet controller "${o}" instance for host controller "${this.identifier}"`)}throw new Error(`Missing outlet element "${o}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${e}".`)}},[`${n}Outlets`]:{get(){const t=this.outlets.findAll(o);return t.length>0?t.map((t=>{const e=a(this,t,o);if(e)return e;console.warn(`The provided outlet element is missing an outlet controller "${o}" instance for host controller "${this.identifier}"`,t)})).filter((t=>t)):[]}},[`${n}OutletElement`]:{get(){const t=this.outlets.find(o),e=this.outlets.getSelectorForOutletName(o);if(t)return t;throw new Error(`Missing outlet element "${o}" for host controller "${this.identifier}". Stimulus couldn't find a matching outlet element using selector "${e}".`)}},[`${n}OutletElements`]:{get(){return this.outlets.findAll(o)}},[`has${e(n)}Outlet`]:{get(){return this.outlets.has(o)}}}}(n))),{})}],m.targets=[],m.outlets=[],m.values={};const v=new Set(["svg","path","circle","rect","g","defs","clipPath","use","line","polygon","polyline","ellipse","text","tspan","marker","pattern","mask","symbol","view"]);function y(t,e,...o){if("function"==typeof t)return t(null!=e?e:{},o);const n=v.has(t),r=n?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);if(e)for(const[t,o]of Object.entries(e))"class"===t?r.setAttribute("class",o):"style"===t&&"object"==typeof o?Object.assign(r.style,o):n?r.setAttribute(t,o):t in r?r[t]=o:r.setAttribute(t,o);const s=t=>{"string"==typeof t?r.appendChild(document.createTextNode(t)):t instanceof Node?r.appendChild(t):Array.isArray(t)?t.forEach(s):console.warn("Invalid child type:",t)};return o.forEach(s),r}class w{constructor(t){this._dialog=null,this._controls=null,this._title=null,this._content=null,this._footer=null,this.root=t}get dialog(){return this._dialog||(this._dialog=this.root.querySelector("dialog")),this._dialog}get controls(){return this._controls||(this._controls=this.root.querySelector(".godjango-modal-controls")),this._controls}get title(){return this._title||(this._title=this.root.querySelector(".godjango-modal-header")),this._title}get content(){return this._content||(this._content=this.root.querySelector(".godjango-modal-content")),this._content}get footer(){return this._footer||(this._footer=this.root.querySelector(".godjango-modal-footer")),this._footer}}function b(t,e,o){return new CustomEvent("modal:"+t,{detail:{action:t,modal:e,originalEvent:o}})}class C{constructor(t,e={}){let o=t;o.modal=this,o.dataset.modal="true",this.options=e,this.connect(o),this.options.opened&&this.open()}actions(){return{close:this.close.bind(this),resize:t=>{this.elements.dialog.toggleAttribute("fullscreen")}}}executeAction(t){const e=this.actions();e[t]?e[t]():console.warn(`No action defined for ${t} in modal controls.`)}connect(t){this.elements=new w(t),this.elements.modal=y("div",{class:"godjango-modal-wrapper"},y("dialog",{class:"godjango-modal"},y("div",{class:"godjango-modal-controls",id:"modal-controls"},y("button",{class:"godjango-modal-control godjango-modal-controls-modal-size",id:"modal-controls-size","data-action":"resize",type:"button"},y("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"godjango-modal-controls-icon",viewBox:"0 0 16 16"},y("path",{d:"M0 3.5A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5zM1.5 3a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5z"}),y("path",{d:"M2 4.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1H3v2.5a.5.5 0 0 1-1 0zm12 7a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H13V8.5a.5.5 0 0 1 1 0z"}))),y("button",{class:"godjango-modal-control godjango-modal-controls-modal-close",id:"modal-controls-close","data-action":"close",type:"button"},y("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",class:"godjango-modal-controls-icon",viewBox:"0 0 16 16"},y("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"})))),y("div",{class:"godjango-modal-header",id:"modal-title"}),y("div",{class:"godjango-modal-content",id:"modal-content"}),y("div",{class:"godjango-modal-footer",id:"modal-footer"}))),this.elements.root.appendChild(this.elements.modal),this.documentClickListener=t=>{console.debug("Modal document click listener",t.target),t.target instanceof HTMLElement&&!this.elements.dialog.contains(t.target)&&this.close(t)};const e=this.elements.controls.querySelectorAll("[data-action]"),o=this.actions();e.forEach((t=>{const e=t.dataset.action;e&&o[e]?t.addEventListener("click",(t=>{t.preventDefault(),o[e](t)})):console.warn(`No action defined for ${e} in modal controls.`)}))}disconnect(){this.elements.root.modal=null,this.elements.modal&&this.elements.root.removeChild(this.elements.modal)}open(t){this.elements.dialog?this.elements.dialog.open?console.warn("Modal is already open."):(this.elements.dialog.showModal(),this.elements.root.dispatchEvent(b("modal:open",this,t)),setTimeout((()=>{this.elements.modal.addEventListener("click",this.documentClickListener)})),this.options.onOpen&&this.options.onOpen(t)):console.warn("Modal dialog element not found.")}close(t){this.elements.dialog?this.elements.dialog.open?(this.elements.dialog.close(),this.elements.root.dispatchEvent(b("modal:close",this,t)),this.elements.root.removeEventListener("click",this.documentClickListener),this.options.onClose&&this.options.onClose(t)):console.warn("Modal is not open."):console.warn("Modal dialog element not found.")}set controls(t){"string"==typeof t?this.executeAction(t):t instanceof HTMLElement?(this.elements.controls.innerHTML="",this.elements.controls.appendChild(t)):console.warn("Invalid controls value:",t)}set title(t){"string"==typeof t?this.elements.title.innerHTML=t:t instanceof HTMLElement?(this.elements.title.innerHTML="",this.elements.title.appendChild(t)):console.warn("Invalid title value:",t)}set content(t){"string"==typeof t?this.elements.content.innerHTML=t:t instanceof HTMLElement?(this.elements.content.innerHTML="",this.elements.content.appendChild(t)):console.warn("Invalid content value:",t),this.options.executeScriptsOnSet&&this.elements.content.querySelectorAll("script").forEach((t=>{const e=document.createElement("script");e.dataset.initialized="true",[...t.attributes].forEach((t=>e.setAttribute(t.name,t.value))),t.textContent&&(e.textContent=t.textContent),t.parentNode.replaceChild(e,t)}))}get root(){return this.elements.root}get dialog(){return this.elements.dialog}get controls(){return this.elements.controls}get title(){return this.elements.title}get content(){return this.elements.content}get footer(){return this.elements.footer}}var E=function(t,e,o,n){return new(o||(o=Promise))((function(r,s){function i(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,l)}a((n=n.apply(t,e||[])).next())}))};class j{constructor(t){this.config=t,this.config.modalClass||(this.config.modalClass="godjango-modal-wrapper"),this.modalWrapper=document.getElementById(this.config.modalClass),this.modalWrapper||(this.modalWrapper=document.createElement("div"),this.modalWrapper.id=this.config.modalClass,this.modalWrapper.className=this.config.modalClass,document.body.appendChild(this.modalWrapper))}disconnect(){this.modal=null,this.modal.disconnect()}fetch(t){return E(this,arguments,void 0,(function*(t,e="GET",o,n){const r={method:e,headers:Object.assign({Accept:"application/json"},n)};o&&"GET"!==r.method.toUpperCase()&&(r.body=o instanceof FormData?o:JSON.stringify(o));const s=new Request(t,r),i=yield fetch(s);if(!i.ok)throw new Error(`Failed to fetch ${t}: ${i.statusText}`);var l=yield i.json();if(!l.html&&!l.pk&&!l.preview)throw new Error(`Invalid response from ${t}: missing html in ${Object.keys(l)}`);if(l.errors&&l.errors.length>0)for(const e of l.errors)console.error(`Error from ${t}:`,e);return l}))}get searchForm(){return this.modal.content.querySelector(".godjango-chooser-list-form")}loadModalContent(t){return E(this,arguments,void 0,(function*(t,e="GET",o,n){console.debug("Loading modal content from:",t);try{const r=yield this.fetch(t,e,o,n);if(r.pk)return r;this.modal.content=r.html}catch(t){console.error("Error loading modal content:",t)}return null}))}select(t,e,o){this.config.onChosen?this.config.onChosen(t,e,o):console.error("Chooser onChosen callback is not defined")}setup(){return E(this,void 0,void 0,(function*(){this.modal.title=`<h1>${this.config.title}</h1>`,yield this.showList()}))}teardown(){return E(this,void 0,void 0,(function*(){this.modal.disconnect()}))}open(){return E(this,void 0,void 0,(function*(){this.modal=new C(this.modalWrapper,{opened:!0,executeScriptsOnSet:!0,onOpen:()=>{this.config.onOpen&&this.config.onOpen()},onClose:t=>E(this,void 0,void 0,(function*(){yield this.teardown(),this.config.onClosed&&this.config.onClosed()}))}),yield this.setup()}))}close(){return E(this,void 0,void 0,(function*(){this.modal.close(),yield this.teardown()}))}showList(){return E(this,arguments,void 0,(function*(t=this.config.listurl){yield this.loadModalContent(t),this.modal.content.querySelectorAll(".godjango-chooser-list-group").forEach((t=>{t.addEventListener("click",(e=>{if(e.target.classList.contains("chooser-list-link")||e.target.closest(".chooser-list-link"))console.debug("Clicked on link inside chooser row, ignoring row click");else{e.stopPropagation(),e.preventDefault();var o=t.dataset.chooserValue,n=t.dataset.chooserPreview;this.select(o,n,JSON.parse(t.dataset.chooserData||"{}")),this.close()}}))})),this.searchForm&&this.searchForm.addEventListener("submit",(t=>E(this,void 0,void 0,(function*(){t.preventDefault();const e=new FormData(this.searchForm),o=new URLSearchParams(e),n=`${this.config.listurl}?${o.toString()}`;yield this.showList(n)})))),this.modal.content.querySelectorAll(".pagination a, .chooser-list-link").forEach((t=>{t.addEventListener("click",(e=>E(this,void 0,void 0,(function*(){e.preventDefault();const o=t.getAttribute("href");o?yield this.showList(o):console.warn("Chooser link has no href:",t)}))))}));var e=this.modal.content.querySelector(".godjango-chooser-list-create a");e&&e.addEventListener("click",(t=>E(this,void 0,void 0,(function*(){t.preventDefault();let o=this.config.createurl||e.href;yield this.showCreate(o)}))))}))}showCreate(){return E(this,arguments,void 0,(function*(t=this.config.createurl,e="GET",o=null){let n=yield this.loadModalContent(t,e,o);if(n)return this.select(n.pk,n.preview,n.data),void(yield this.close());this.modal.content.querySelector("#back-to-list").addEventListener("click",(t=>E(this,void 0,void 0,(function*(){t.preventDefault(),yield this.showList()}))));const r=this.modal.content.querySelector("form");r.addEventListener("submit",(e=>E(this,void 0,void 0,(function*(){e.preventDefault();const o=new FormData(r);yield this.showCreate(t,"POST",o)}))))}))}}var $=function(t,e,o,n){return new(o||(o=Promise))((function(r,s){function i(t){try{a(n.next(t))}catch(t){s(t)}}function l(t){try{a(n.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,l)}a((n=n.apply(t,e||[])).next())}))};function O(t,e,o){return new CustomEvent("modal:"+t,{detail:{action:t,modal:e,originalEvent:o}})}class S extends m{connect(){this.element.chooserController=this,this.chooser=new j({title:this.titleValue,listurl:this.listurlValue,createurl:this.createurlValue,onChosen:this.select.bind(this)})}disconnect(){this.element.chooserController=null,this.element.dataset.chooserController="false",this.chooser.disconnect()}select(t,e){this.inputTarget.value=t,this.previewTarget.innerHTML=e}open(t){return $(this,void 0,void 0,(function*(){yield this.chooser.open(),yield this.element.dispatchEvent(O("open",this,t))}))}close(t){return $(this,void 0,void 0,(function*(){yield this.chooser.close(),yield this.element.dispatchEvent(O("close",this,t))}))}clear(t){return $(this,void 0,void 0,(function*(){if(""===this.inputTarget.value)return;this.inputTarget.value="",this.previewTarget.innerHTML="";const t=getComputedStyle(this.element).borderColor;this.element.animate([{borderColor:"red"},{borderColor:t}],{fill:"forwards",duration:300,easing:"ease-out"})}))}}S.targets=["preview","input"],S.values={title:{type:String},listurl:{type:String},createurl:{type:String}},document.addEventListener("DOMContentLoaded",(()=>{window.Stimulus.register("chooser",S)})),window.Chooser=j})();